# Useful commands: Networking

```text
#add route to vpn provider  while using vpn (with -p command make it permanant- windows cmd )
route add 31.7.74.0 mask 255.255.255.0 192.168.1.1
route delete 31.7.74.0 mask 255.255.255.0 192.168.1.1
# VPN route issue
route add 172.17.0.0 mask 255.255.0.0 172.16.246.1 -p
tracert -d 94.182.189.173
route add 94.182.189.173 mask 255.255.255.255 192.168.1.1 -p
route print
ls -ld (/etc/resolv.conf) (show the source file for symbol links)
#check rx tx for ethernet  error network 
#connect to iLO ip using ssh and putty --> try to ping other IP in network
hp ilo cli --> oemhp_ping 1.1.1.1
lshw -c network | grep -i 10g -C 6
#bonding
cat /proc/net/bonding/bond0
#tshark tcpdump dmesg last x minutes logs
tcpdump -G 1 -W 1 -w file.dump -D 
tcpdump -G 1 -W 1 -w file.dump -i bond0
touch tshark-output.pcap
chmod o=rw tshark-output.pcap
tshark -a duration:1 -i bond0 -w tshark-output.pcap -F libpcap
tshark -r tshark-output.pcap -V 
lshw -class network -short
nmcli
nmtui
dhclient -r
nmap -o <ip>
cd /etc/sysconfig/network-scripts/
grep -rnw /etc/sysconfig/network-scripts/ -e 'bond0'
h=$(ls /etc/sysconfig/network-scripts/| grep bond0)
scp $h e0:/etc/sysconfig/network-scripts/
scp $h e1:/etc/sysconfig/network-scripts/
scp $h e2:/etc/sysconfig/network-scripts/
scp $h c0:/etc/sysconfig/network-scripts/
scp $h c1:/etc/sysconfig/network-scripts/
scp $h c2:/etc/sysconfig/network-scripts/
h=$(ls /etc/sysconfig/network-scripts/| grep br)
echo -e "DEVICE=bond0\nNAME=bond0\nTYPE=Bond\nBONDING_MASTER=yes\nONBOOT=yes\nBOOTPROTO=none\nBONDING_OPTS="mode=4 miimon=100 lacp_rate=1 xmit_hash_policy=2"\nHOTPLUG=yes\nNM_CONTROLLED=no" > ifcfg-bond0
sed -i "s/172.20.120.5/172.20.120.90/g" /etc/sysconfig/network-scripts/ifcfg-br120
tar -zcvpf  /etc/sysconfig/network-scripts/network-back.tgz /etc/sysconfig/network-scripts/*
c=$(ls /etc/sysconfig/network-scripts/ | grep -E 'br|bond0')
echo '#'$h > /etc/sysconfig/network-scripts/$c
for i in $c;do echo '#'$h >> /etc/sysconfig/network-scripts/$i;done
scp $(ls  | grep -E 'bond0|br') c2:/etc/sysconfig/network-scripts/
sed "s/20/20/g" $(ls|grep 'ifcfg-bond0.2')
cat /proc/net/vlan
cat /proc/net/bonding/bon0 | grep Permanent
undercloud network config
controller network config
compute network config
network bridge ovs
test network through switch
test vlan 124,126 from deployer VM
ifconfig -a | grep eth
tar -zcvpf  /etc/sysconfig/network-scripts/network-bak-$(date +"%Y_%m_%d_%I_%M_%p").tgz /etc/sysconfig/network-scripts/*
grep -rnw IPADDR /etc/sysconfig/network-scripts/ifcfg-*
for i in $(ls | grep ifcfg-bond0); do sed -r 's/^IPADDR=172.20.120.*/IPADDR=172.20.120.$lastoctect/g' $i;done
sed -r  "s/^IPADDR=172.20.120.*/IPADDR=172.20.120.$lastoctet/g" ifcfg-bond0.20 && \
sed -r  "s/^IPADDR=172.20.122.*/IPADDR=172.20.122.$lastoctet/g" ifcfg-bond0.22 && \
sed -r  "s/^IPADDR=172.20.124.*/IPADDR=172.20.124.$lastoctet/g" ifcfg-bond0.24 && \
sed -r  "s/^IPADDR=172.20.126.*/IPADDR=172.20.126.$lastoctet/g" ifcfg-bond0.26 && \
sed -r  "s/^IPADDR=172.20.128.*/IPADDR=172.20.128.$lastoctet/g" ifcfg-bond0.28 && \
sed -ri  "s/^IPADDR=172.20.120.*/IPADDR=172.20.120.$lastoctet/g" ifcfg-bond0.20 && \
sed -ri  "s/^IPADDR=172.20.122.*/IPADDR=172.20.122.$lastoctet/g" ifcfg-bond0.22 && \
sed -ri  "s/^IPADDR=172.20.124.*/IPADDR=172.20.124.$lastoctet/g" ifcfg-bond0.24 && \
sed -ri  "s/^IPADDR=172.20.126.*/IPADDR=172.20.126.$lastoctet/g" ifcfg-bond0.26 && \
sed -ri  "s/^IPADDR=172.20.128.*/IPADDR=172.20.128.$lastoctet/g" ifcfg-bond0.28 && \
iptables -F
iptables -L -n -v
systemctl stop iptables
systemctl status iptables
systemctl disable iptables
systemctl mask --now iptables
echo -e "; generated by /usr/sbin/dhclient-script\nsearch localdomain\nnameserver 178.22.122.100\nnameserver 185.51.200.2\n" > /etc/resolv.conf
echo -e "; generated by /usr/sbin/dhclient-script\n" > ifcfg-bond0
ip link show type bond_slave
ip -details link show dev <ovs-system>
ip link show type openvswitch
It's there so that the bridge has at least one interface beneath it to steal it's mac address from. It passes no real traffic, since it's not really connected to any physical device.
The bridge would work without it, but then it could change it's mac address as interfaces enter and exit the bridge, and when the mac of the bridge changes, external switches may be confused, making the host lose network for some time.
      <mac address='52:54:00:e2:b8:df'/>
      <mac address='52:54:00:7e:58:60'/>
      <mac address='52:54:00:4b:1f:77'/>
ifconfig ens3 172.20.123.7/24
route add default gw 172.20.123.250
#ubuntu machine usefull config
vim /etc/netplan/00-installer-config.yaml
network:
  renderer: networkd
  bonds:
      bond0:
  vlans:
     bond0.1709:
          link: bond0
     bond0.1710:
netplan apply
ip link set ens9 down
ip link set ens9 up
systemctl list-unit-files | grep -i network
nmap -sP 389 172.20.123.7
tar -tvf  /etc/sysconfig/network-scripts/network-back.tgz | grep eth
docker run -v ${PWD}/reports:/app/reports --network="host" \
iperf
#datacentername vlaning 
datacentername provision = vlan202
nmap -T4 -A -v 172.41.203.21
iptables-save > /root/controller3.fw
iptables-restore < /root/dsl.fw
shecan failed--> check docker.io ping banned website like bbc.com then retry
No IPs found for Compute role on ctlplane network--> check connection over provisioning vlan(access provisioning-->ctlplane) to all nodes, check switch config or boot server using slax and set manual IP and check connection to ensure
https://dns.sb/guide/doh/linux/#_2-connect-dns-sb-doh-server
dnsproxy -l 127.0.0.1 -p 53 -u free.shecan.ir -b 185.51.200.2:53
| ID                                   | Name                    | Status | Networks                | Image          | Flavor  |
iptables -I INPUT -s 79.127.117.114 -p tcp -m multiport --dports 8044 -m state --state NEW -m comment --comment "accept phpmyadmin from external" -j ACCEPT
curl https://api.dnslab.ir/ip
########create bond and vlan
modprobe bonding
ip link add bond0 type bond mode 802.3ad
ifenslave  bond0 eth2 eth3 # this or following two lines
ip link set eth6 master bond0 #1
ip link set eth7 master bond0 #2
ifconfig bond0 up
ip link add link bond0 name vlan203 type vlan id 203
ip link add link bond0 name vlan100 type vlan id 100
ifconfig vlan203 up
ifconfig vlan100 up
ifconfig vlan203 172.18.203.25 netmask 255.255.255.0
ifconfig vlan100 172.18.100.25 netmask 255.255.255.0
ip route add default via 172.18.203.1 dev vlan203
echo -e "nameserver 178.22.122.100\nnameserver 185.51.200.2" > /etc/resolv.conf
export mac=00:fd:45:4c:51:e8
echo "SUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\", ATTR{address}==\"$mac\", ATTR{type}==\"1\", KERNEL==\"eth*\" NAME=\"eth$e\"" > /mnt2/etc/udev/rules.d/70-persistent-net.rules
export mac=00:fd:45:4c:51:f0
echo "SUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\", ATTR{address}==\"$mac\", ATTR{type}==\"1\", KERNEL==\"eth*\" NAME=\"eth$e\"" >> /mnt2/etc/udev/rules.d/70-persistent-net.rules
export mac=98:f2:b3:28:bf:50
############ ubuntu netplan - bonding and vlan
network qos:
ovs-vsctl set open . external-ids:ovn-remote=tcp:172.20.120.10:6642
ovs-vsctl set open . external-ids:hostname="sh-economy-compute-008-rack-1.localdomain"
ovs-vsctl set open . external-ids:ovn-encap-type=geneve
ovs-vsctl set open . external-ids:ovn-encap-ip=172.20.122.30
ovs-vsctl set open . external-ids:ovn-bridge=br-int
ovs-vsctl set open . external-ids:ovn-bridge-mappings="datacentre:br-ex"
ovs-vsctl set open . external-ids:ovn-openflow-probe-interval="60"
ovs-vsctl set open . external-ids:ovn-remote-probe-interval="60000"
ovs-vsctl set-manager ptcp:6640:127.0.0.1
 rush hours(Every morning, between 8am and 9am, a company network experiences a data spike as employees log in and begin to use the network resources)
#############add bond using ip command
ip link add bond0 type bond
ip link set em1 down
ip link set em1 master bond0
ip link set em2 down
ip link set em2 master bond0
ip link set bond0 up
ip link add link bond0 name bond0.2 type vlan id 2
#Set VLAN on the bond device:
ip link add link bond0 name bond0.2 type vlan id 2
ip link set bond0.2 up
#Add the bridge device and attach VLAN to it:
ip link add br0 type bridge
ip link set bond0.2 master br0
ip link set br0 up
networking-->Default TCP/IP stack--> edit
and add domain http://domain.com.au and DNS 1.1.1.1
ping -O 31.7.74.102 -i 0.2 -c 300
ip route
route add $VPN_SERVER_IP gw 172.16.0.1
route add default dev ppp0
#### fix route server itself (ssh unavailability) ***************
route add $(wget -qO- http://ipv4.icanhazip.com; echo) gw 172.16.0.1
###lvs vgs pvs | delete any data from machine
nmap -PE -sn 86.104.44.213/24
##########network tools to check
nmcli --version
NetworkManager --version
rmadison network-manager
systemctl status NetworkManager
apt search network-manager-
netplan
/et/network/interfaces
ansible -i inventory.ini all -m ping
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE 
ip link set dev ens160 down && ip link set dev ens160 up 
ip route del default
ip route add default via 10.0.0.49
ethtool -g eth2
ethtool -G eth2 rx 4078
https://pingtool.org/latest-hp-ilo-firmwares/
dd if=/dev/sda of=/remotemachineOranotherdisk/img.img bs=512 status=progress
### resolve mac address using IP (in case of possibility of multi mac address like VRRP or pod's external IP)
apt install iputils-arping -y
arping -I ens160 -c 1 10.0.0.40
### test network bandwitch using iperf
    iperf -s
    iperf -c node1 -P 2
### Restart Network Service in Ubuntu  [ref](https://askubuntu.com/questions/230698/how-to-restart-the-networking-service)
Restarting networking on a desktop machine will cause dbus and a bunch of service to stop and never be started again, usually leading to the whole system being unusable.
As Ubuntu does event based network bring up, there quite simply isn't a way to undo it all and redo it all, so a restart just isn't plain possible. The recommended way instead is to use ifdown and ifup on the interfaces you actually want to reconfigure:
```